# TLSとは
## TLSとは？
TLS（Transport Layer Security）とは、インターネット上の通信を暗号化して安全にするためのプロトコルです。  
かつて使われていた SSL（Secure Sockets Layer） の後継で、現在はTLSが標準です。

### TLSの目的（なぜ使うのか？）
TLSは以下の3つを守るために使われます

| 目的     | 説明                              |
| ------ | ------------------------------- |
| 🔐 暗号化 | 通信内容を第三者に見られないようにする（盗聴防止）       |
| ✅ 認証   | 相手が本物かどうかを確認する（なりすまし防止）         |
| 🧾 完全性 | 通信内容が途中で改ざんされていないことを保証する（改ざん防止） |

### TLSが使われる例
| 使われる場所 | 具体例                                     |
| ------ | --------------------------------------- |
| Webサイト | `https://example.com` の「https」はTLSを意味する |
| API通信  | REST APIやGraphQLなどの通信保護に必須              |
| メール    | SMTPS, IMAPS, POP3S などの安全なメール通信         |
| VPN    | 通信経路の暗号化に使用                             |

### TLS通信の流れ
HTTPSサイトにアクセスすると、TLSは次のような手順で動きます：

- (1) クライアント → サーバーへ：「TLS通信したいです」（Client Hello）
- (2) サーバー → クライアントへ：証明書（公開鍵）を送る
- (3) クライアントが証明書を検証：本物のサーバーか確認
- (4) 共通鍵（セッションキー）を交換：この鍵で通信内容を暗号化
- (5) 暗号化された通信が始まる

→ このやりとりを TLSハンドシェイク と呼びます。

### TLSを使うと何が安全になる？
- 個人情報やログイン情報が漏れにくくなる
- 中間者攻撃（MITM）を防ぐ
- IDやパスワードの送信も安全

### TLSとSSLの違いは？
| SSL                    | TLS             |
| ---------------------- | --------------- |
| 古いバージョン（1.0, 2.0, 3.0） | 現在の標準（1.2, 1.3） |
| セキュリティの弱点がある           | より安全で高速         |
| 現在は非推奨                 | WebもAPIもTLSが主流  |

現在は「SSL」と言っていても、実際にはTLSが使われていることがほとんどです。

### まとめ
- TLSは通信を安全にするためのプロトコル
- HTTPSやAPI通信、メールなど多くのサービスで使われている
- 盗聴・改ざん・なりすましを防ぐ役割を持つ
- SSLはTLSの旧バージョンで、今は使われていない

----
## mTLS(相互TLS認証)とは？
サーバーもクライアントも、お互いの証明書を提示して認証し合うTLS通信方式です。  
通常のTLS（HTTPS）と違い、両者が「あなたは本物ですか？」と確認し合います。

### 通常のTLSとの違い
| 通信方式            | 認証対象                      | 使いどころ            |
| --------------- | ------------------------- | ---------------- |
| 通常のTLS（HTTPS）   | サーバーのみ（クライアントがサーバー証明書を確認） | Webブラウザ〜Webサイト   |
| **mTLS（相互TLS）** | サーバー＋クライアント両方             | API通信・ゼロトラスト構成など |

### mTLSの通信イメージ
- (1) クライアント → サーバーにTLS接続を開始（クライアントHello）
- (2) サーバー → 証明書を提示
- (3) クライアント → サーバーの証明書を検証（通常と同じ）
- (4) サーバー → 「あなた（クライアント）も証明書を出してください」と要求
- (5) クライアント → 証明書を提示
- (6) サーバー → クライアントの証明書を検証（CAの信頼など）

→ 成功すれば、両者の身元を保証した状態で通信スタート！

### なぜmTLSを使うの？
| 利点                | 説明                              |
| ----------------- | ------------------------------- |
| ✅ 高いセキュリティ        | パスワードやトークンに比べて**なりすましが極めて困難**   |
| ✅ 自動・非対話的         | 機械間通信（API-to-API）に最適            |
| ✅ ゼロトラストセキュリティに対応 | ネットワーク内部でも通信元を証明しなければ通さない設計に使える |

### 使われる場面の例
| シーン               | 詳細                               |
| ----------------- | -------------------------------- |
| API通信（特に金融系・医療系）  | 機密性が求められる双方向認証                   |
| マイクロサービス間通信       | KubernetesやService Mesh環境で使われる   |
| Salesforceなどの外部連携 | Named Credentialに証明書を添付して相互TLS認証 |
| VPNや企業内システム接続     | クライアント証明書を使った端末認証にも使われる          |

### 注意点
| 課題                     | 内容                  |
| ---------------------- | ------------------- |
| 証明書の配布・管理が面倒           | クライアント側にも証明書と秘密鍵が必要 |
| 更新・ローテーションの自動化が必要      | 有効期限切れ対策が重要         |
| 中間CA・ルートCAとの信頼関係も構成が必要 | 検証ルールの設計が複雑になることも   |

### まとめ
- mTLS（Mutual TLS） は、サーバーだけでなくクライアントも証明書で認証されるTLS通信方式
- 高セキュリティ・非対話型認証に向いており、API間通信やゼロトラスト環境で重宝される
- 運用は複雑だが、証明書ベースでの強固な本人確認が必要な場面で強力




